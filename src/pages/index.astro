---
import Items from "@/components/items.astro";
import Navigation from "@/components/navigation.astro";
import Layout from "@/layouts/layout.astro";
import { getCollection, getEntries } from "astro:content";

const collection = await getCollection("issues");
const issues = collection
  .filter((issue) =>
    import.meta.env.PROD ? issue.data.status === "published" : true,
  )
  .sort((a, b) => b.data.published.getTime() - a.data.published.getTime());

const allItems = await Promise.all(
  issues.map(async (issue) => {
    const items = await getEntries(issue.data.items);
    return items;
  }),
);

const flattenedItems = allItems.flat();
---

<Layout>
  <Navigation />
  <Items entries={flattenedItems} />
</Layout>
